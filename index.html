<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style/style.css">
        <script type="text/javascript" src="javascripts/virtualjoystick.js"></script>
        <script src="javascripts/jquery-1.11.2.min.js"></script>
        <script src="javascripts/socket.io.js"></script>
    </head>
    <body>
        <img id="videofeed" src="http://192.168.10.1:8080/stream/video.mjpeg" alt="If you see this message check the availability of video stream">
        <div id="sticksContainer">
            <div id="stick1"></div>
            <div id="stick2"></div>
        </div>
    </body>
    <script type="text/javascript">
      //Define refresh interval (in seconds)
      var interval = 1/10;
      var acc=1;

      var previousIsZero = true;

      console.log("Touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");
      var socket = io.connect('http://192.168.10.1:3000');

      //LEFT Stick
      var joystickL = new VirtualJoystick({
        container : document.getElementById('stick1'),
        strokeStyle : 'cyan',
        mouseSupport  : true,
        limitStickTravel: true,
//      stationaryBase:true,
//      baseX   : 200,
//      baseY   : 200,
        stickRadius : 200
      });
          
      // RIGHT Stick
      var joystickR = new VirtualJoystick({
        container : document.getElementById('stick2'),
        strokeStyle : 'orange',
        mouseSupport  : true,
        limitStickTravel: true,
        stickRadius : 200
      });
      //if (acc == 1){
          window.ondevicemotion =function(event){
            var accelerationX = event.accelerationIncludingGravity.x;  
            var accelerationY = event.accelerationIncludingGravity.y; 
            joystickR.deltaX()=0;
            joystickR.deltaY()=0; 
            socket.emit('coordinate',{DXL: accelerationX ,DYL: accelerationY,DXR: joystickR.deltaX(),DYR: joystickR.deltaY()});
          }
      // }else{
      //   // INTERVAL EVENT
      //   setInterval(function(){
      //     // If previous value is 0,0
      //     if ((joystickL.deltaX() == 0) && (joystickL.deltaY() == 0) && previousIsZero==true){

      //     }else{
      //       socket.emit('coordinate',{DXL: joystickL.deltaX(),DYL: joystickL.deltaY(), DXR: joystickR.deltaX(),DYR: joystickR.deltaY() });
      //       if ((joystickL.deltaX() == 0) && (joystickL.deltaY() == 0)){
      //         previousIsZero=true;
      //       }else {
      //         previousIsZero=false; 
      //       }
      //     }
      //   }, interval *1000);
      // }
    </script> 
</html>
