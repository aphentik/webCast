<html>
    <head>
        <script type="text/javascript" src="javascripts/virtualJoystick.js"></script>
        <script src="javascripts/jquery-1.11.2.min.js"></script>
        <script src="javascripts/socket.io.js"></script>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style/style.css">
    </head>
    <body>
        <div id="info">
            WEBCAST
            <br/>
            <span id="resultl"></span>
            <span id="resultr"></span>
        </div>
        <img id="videofeed" src="http://192.168.10.1:8080/stream/video.mjpeg" alt="image">
        <div id="sticksContainer">
            <div id="stick1"></div>
            <div id="stick2"></div>
        </div>
    </body>
    <script type="text/javascript">

      //Define refresh interval (in seconds)
      var interval = 1/5;

      var previousX=0;
      var previousY=0;

      console.log("Touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");
      var socket = io.connect('http://localhost:3000');

      //LEFT Stick
      var joystickL = new VirtualJoystick({
        container : document.getElementById('stick1'),
        strokeStyle : 'cyan',
        mouseSupport  : true,
        limitStickTravel: true,
//      stationaryBase:true,
//      baseX   : 200,
//      baseY   : 200,
        stickRadius : 100
      });
          
      // RIGHT Stick
      var joystickR = new VirtualJoystick({
        container : document.getElementById('stick2'),
        strokeStyle : 'orange',
        mouseSupport  : true,
        limitStickTravel: true,
        stickRadius : 100
      });

      // INTERVAL EVENT
      setInterval(function(){
        // var outputEl  = document.getElementById('resultl');
        // outputEl.innerHTML  = '<b>Left stick Result:</b> '
        // + ' dx:'+joystickL.deltaX()
        // + ' dy:'+joystickL.deltaY()
        // + (joystickL.right()  ? ' right'  : '')
        // + (joystickL.up() ? ' up'   : '')
        // + (joystickL.left() ? ' left' : '')
        // + (joystickL.down() ? ' down'   : '')

        // var outputEl  = document.getElementById('resultr');
        // outputEl.innerHTML  = '<b>Left stick Result:</b> '
        // + ' dx:'+joystickR.deltaX()
        // + ' dy:'+joystickR.deltaY()
        // + (joystickR.right()  ? ' right'  : '')
        // + (joystickR.up() ? ' up'   : '')
        // + (joystickR.left() ? ' left' : '')
        // + (joystickR.down() ? ' down'   : '')

        // If value is the same as previously
        if ((joystickL.deltaX() == previousX) && (joystickL.deltaY() == previousY)){

        }else{
          socket.emit('coordinate',{DXL: joystickL.deltaX(),DYL: joystickL.deltaY(), DXR: joystickR.deltaX(),DYR: joystickR.deltaY() });
          previousX=joystickL.deltaX(); 
          previousY=joystickL.deltaY();
        }
      }, interval *1000);
    </script> 
</html>
